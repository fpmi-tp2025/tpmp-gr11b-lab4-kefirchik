BEGIN TRANSACTION;
CREATE TABLE IF NOT EXISTS "BANKS" (
	"BANK_ID"	INTEGER,
	"NAME"	VARCHAR(100) NOT NULL UNIQUE,
	PRIMARY KEY("BANK_ID" AUTOINCREMENT)
);
CREATE TABLE IF NOT EXISTS "BONUSES" (
	"BONUS_ID"	INTEGER,
	"CREW_ID"	INTEGER NOT NULL,
	"VOYAGE_ID"	INTEGER NOT NULL,
	"AMOUNT"	DECIMAL(10, 2) NOT NULL,
	"CALCULATED_AT"	TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	"PERIOD_START"	TEXT,
	"PERIOD_END"	TEXT,
	PRIMARY KEY("BONUS_ID" AUTOINCREMENT),
	FOREIGN KEY("CREW_ID") REFERENCES "CREW_MEMBERS"("CREW_ID") ON DELETE CASCADE,
	FOREIGN KEY("VOYAGE_ID") REFERENCES "VOYAGES"("VOYAGE_ID") ON DELETE CASCADE
);
CREATE TABLE IF NOT EXISTS "CATCHES" (
	"CATCH_ID"	INTEGER,
	"VOYAGE_ID"	INTEGER NOT NULL,
	"BANK_ID"	INTEGER NOT NULL,
	"FISH_TYPE"	VARCHAR(50) NOT NULL,
	"QUANTITY_KG"	REAL NOT NULL,
	"QUALITY"	TEXT DEFAULT 'medium' CHECK("QUALITY" IN ('high', 'medium', 'low')),
	"RECORDED_AT"	TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY("CATCH_ID" AUTOINCREMENT),
	FOREIGN KEY("BANK_ID") REFERENCES "BANKS"("BANK_ID") ON DELETE CASCADE,
	FOREIGN KEY("VOYAGE_ID") REFERENCES "VOYAGES"("VOYAGE_ID") ON DELETE CASCADE
);
CREATE TABLE IF NOT EXISTS "CREW_MEMBERS" (
	"CREW_ID"	INTEGER,
	"LAST_NAME"	VARCHAR(50) NOT NULL,
	"POSITION"	VARCHAR(50) DEFAULT 'crew' CHECK("POSITION" IN ('crew', 'fisherman', 'captain')),
	"HIRE_DATE"	INTEGER,
	"BIRTH_YEAR"	INTEGER,
	"TRAWLER_ID"	INTEGER NOT NULL,
	PRIMARY KEY("CREW_ID" AUTOINCREMENT),
	FOREIGN KEY("TRAWLER_ID") REFERENCES "TRAWLERS"("TRAWLER_ID") ON DELETE CASCADE
);
CREATE TABLE IF NOT EXISTS "FLEET_USERS" (
	"USER_ID"	INTEGER,
	"LOGIN"	VARCHAR(50) NOT NULL UNIQUE,
	"PASSWORD_HASH"	VARCHAR(255) NOT NULL,
	"ROLE"	TEXT NOT NULL CHECK("ROLE" IN ('admin', 'crew_member')),
	"CREATED_AT"	TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY("USER_ID" AUTOINCREMENT)
);
CREATE TABLE IF NOT EXISTS "TRAWLERS" (
	"TRAWLER_ID"	INTEGER,
	"NAME"	VARCHAR(100) NOT NULL UNIQUE,
	"DISPLACEMENT"	REAL,
	"BUILD_DATE"	INTEGER,
	PRIMARY KEY("TRAWLER_ID" AUTOINCREMENT)
);
CREATE TABLE IF NOT EXISTS "VOYAGES" (
	"VOYAGE_ID"	INTEGER,
	"TRAWLER_ID"	INTEGER NOT NULL,
	"START_DATE"	TEXT NOT NULL,
	"END_DATE"	TEXT,
	PRIMARY KEY("VOYAGE_ID" AUTOINCREMENT),
	FOREIGN KEY("TRAWLER_ID") REFERENCES "TRAWLERS"("TRAWLER_ID") ON DELETE CASCADE
);
INSERT INTO "BANKS" VALUES (1,'Great British Bank');
INSERT INTO "BANKS" VALUES (2,'Baltic Sea Bank');
INSERT INTO "BANKS" VALUES (3,'Black Sea Bank');
INSERT INTO "BANKS" VALUES (4,'Mediterranean Sea Bank');
INSERT INTO "CREW_MEMBERS" VALUES (1,'Smith','crew',2007,1967,1);
INSERT INTO "CREW_MEMBERS" VALUES (2,'Anderson','fisherman',1988,1962,1);
INSERT INTO "CREW_MEMBERS" VALUES (3,'Johnson','captain',1976,1953,1);
INSERT INTO "CREW_MEMBERS" VALUES (4,'Kennedy','crew',2014,1998,2);
INSERT INTO "CREW_MEMBERS" VALUES (5,'Harris','fisherman',2000,1979,2);
INSERT INTO "CREW_MEMBERS" VALUES (6,'Smith','captain',1995,1968,2);
INSERT INTO "CREW_MEMBERS" VALUES (7,'Greene','crew',2015,1983,3);
INSERT INTO "CREW_MEMBERS" VALUES (8,'Greene','fisherman',2015,1979,3);
INSERT INTO "CREW_MEMBERS" VALUES (9,'Greene','captain',2015,1965,3);
INSERT INTO "CREW_MEMBERS" VALUES (10,'Miller','crew',1993,1968,4);
INSERT INTO "CREW_MEMBERS" VALUES (11,'Ryan','fisherman',1988,1970,4);
INSERT INTO "CREW_MEMBERS" VALUES (12,'Lee','captain',1999,1966,4);
INSERT INTO "CREW_MEMBERS" VALUES (13,'King','crew',1962,1943,5);
INSERT INTO "CREW_MEMBERS" VALUES (14,'Kennedy','fisherman',1965,1950,5);
INSERT INTO "CREW_MEMBERS" VALUES (15,'Long','captain',1962,1937,5);
INSERT INTO "TRAWLERS" VALUES (1,'One-eyed John',2.56,1976);
INSERT INTO "TRAWLERS" VALUES (2,'Victory',136.0,1993);
INSERT INTO "TRAWLERS" VALUES (3,'Great Seal',422.0,2015);
INSERT INTO "TRAWLERS" VALUES (4,'Lighthouse',317.0,1988);
INSERT INTO "TRAWLERS" VALUES (5,'New Don',248.0,1962);
COMMIT;
